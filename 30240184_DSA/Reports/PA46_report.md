# PA4-6 报告

## Sort

### 1. 题意

给定一个比较器，能知道某一个序列的三个下标的最大值、最小值的下标，要求实现一个排序算法，使得排序次数在给定的阈值以内。

### 2. 解题思路

这个显然要求能实现多个区段排序的算法。不难想象，可以利用归并排序，把原有的二路合并，改为多路合并，仍然是在多个有序子列中求最小元，塞到暂存序列的尾部。

具体而言，就是把后面合并的部分更改。

显然可以把序列三等分，直接执行三路归并，不过经分析时间，如果实现三路归并，比较次数的数量级为 $ 10 ^ 6 \log_3 (10 ^ 6) = 1.26 \times 10 ^ 7 $ 次，不合测例 17，18 和 20 的要求。

如果实现四路合并，比较次数的数量级优化为 $ 10 ^ 6 \log_4 (10 ^ 6) = 9.97 \times 10 ^ 6 $ 次，符合要求。

### 3. 具体实现

在合并部分开始的时候，执行两次比较，找到最小的区段。

接着在暂存数组记录下标，然后把下标后移。

从第二次开始，比较上一次包含最大元素下标以外的另外三个元素的下标。

这样做的原因，是虽然最小的那个元素下标被填入，更新后有可能不是最小元素，但由于最大性蕴含着：存在一个区段，它的当前的“头”的下标对应元素比最大元素为小，且那个区段的“头”没有被插入，因此上一次的最大元素，肯定不能为现阶段那四个区段的“头”元素的最小值，就不必比较了。

### 4. 注意事项

分为两个部分：

一是朴素的二路归并的递归终止条件是数组长度为1，但对于四路归并，长度小于四都是递归的终止条件。这时，可以调用一次比较器，直接比较数组的所有元素。

二是当有其中一个区段的所有元素下标入列之后，就应该直接调用平凡的二元、三元比较，而不应该拘泥于优化算法，因为优化作用不大。

